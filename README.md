# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении


Данные используемые в форме оплаты
```
type TUserPayment = Pick<IUserModel, "payment" | "address">;
```

Данные используемые в форме пользовательских данных
```
type TUserContact = Pick<IUserModel, "email" | "phone">;
```

Тип оплаты
```
type PaymentType = "online" | "offline";
```

Товар
```
interface IProductModel {
	id: string;
	title: string;
	category: string;
	image: string;
	price: number | null;
	
```

Заказ
```
interface IUserModel {
	payment: PaymentType;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
}
```

Интерфейс для списка товаров
```
interface IProductList {
	products: IProductModel[];
	preview: string | null;
	addProduct(product: IProductModel): void;
	deleteProduct(productId: string): void;
	getProduct(productId: string): IProductModel;
}
```

Корзина
```
interface IBasket {
	products: IProductModel[];
	addProduct(product: IProductModel): void;
	deleteProduct(productId: string): void;
	clearCart(): void;
	getProducts(): IProductModel[];
	getTotalPrice(): number;
}
```

Интерфейс для взаимодействия с сервером
```
interface IApiClient {
	getProductById(productId: string): Promise<IProductModel>;
	getProducts(): Promise<IProductModel[]>;
	createOrder(order: IUserModel): Promise<IUserModel>;
}
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие


### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _products: IProduct[] — массив объектов товаров.
- _preview: string | null — id товара, выбранного для просмотра в модальном окне.
- events: IEvents — экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addProduct(product: IProduct): void — добавляет один продукт в начало массива.
- deleteProduct(productId: string): void — удаляет продукт из массива.
- а так-же сеттеры и геттеры — для сохранения и получения данных из полей класса.

#### UserData
Класс отвечает за хранение и логику работы с данными заказа.\
В полях класса хранятся следующие данные:
- payment: PaymentType — тип платежа (например, "online" или "offline").
- address: string — адрес для доставки.
- email: string — email пользователя.
- phone: string — телефон пользователя.
- total: number - общая цена заказа 
- items: string[] - массив id заказанных товаров 
- events: IEvents — экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- сеттеры и геттеры — для сохранения и получения данных из полей класса.

#### Класс basketData
Класс отвечает за хранение и логику работы с данными корзины.\
В полях класса хранятся следующие данные:
- products: IProduct[] — массив продуктов, добавленных в корзину.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addProduct(product: IProduct): void — добавляет продукт в корзину.
- deleteProduct(productId: string): void — удаляет продукт из корзины.
- getProducts(): IProduct[] — возвращает все продукты из корзины.
- clearCart(): void; - удаляет все продукты из корзины.
- getProductIds(): string[] - возвращает массив id товаров в корзине
- getTotalPrice(): number — вычисляет общую стоимость продуктов в корзине.
- getTotalCount(): number - возвращает число товаров в корзине
- findProduct(productId: string): boolean - дает информации о наличии товара в корзине.


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Component
Базовый абстрактный класс, представляющий UI-компонент. Содержит вспомогательные методы для работы с DOM-элементами и их обновления.
Конструктор класса принимает корневой элемент компонента.
Методы:
- toggleClass(element: HTMLElement, className: string, force?: boolean): void - Переключает CSS-класс у элемента.
- setText(element: HTMLElement, value: unknown): void - Устанавливает текстовое содержимое элемента.
- setVisible(element: HTMLElement): void - Делает элемент видимым, удаляя свойство display.
- setImage(element: HTMLImageElement, src: string, alt?: string): void - Устанавливает изображение в элемент <img>.
- render(data?: Partial<T>): HTMLElement - Обновляет компонент, применяя переданные данные, и возвращает его корневой элемент.

#### Класс View
Расширяет класс Component, добавляя поддержку системы событий.
Конструктор принимает объект для управления событиями и корневой элемент компонента.

#### Класс Modal
Расширяет класс View. Реализует модальное окно. Так же предоставляет методы `open`, `close` и `render` для управления отображением модального окна.
Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.
-constructor(events: IEvents, container: HTMLElement)
Поля класса:
- content: HTMLElement - внутренность элемента модального окна.
- closeButton: HTMLElement - кнопка закрытия модалки.
- events: IEvents - брокер событий.

#### Класс Form 
Абстрактный класс, расширяющий View, который представляет собой форму с обработкой ввода, валидацией и отправкой данных.
Поля класса:
- submitButton: HTMLButtonElement — кнопка отправки формы.
- inputs: HTMLInputElement[] — массив всех полей ввода в форме.
- buttons: HTMLButtonElement[] — массив всех кнопок в форме.
- errors: Record<string, HTMLElement> — объект для хранения элементов ошибок.
Методы:
- getInputValues(): Record<string, string> - Собирает и возвращает объект со значениями всех полей формы.
- setInputValues(fieldName: string, value: string): void - Устанавливает переданное значение в поле формы с указанным именем.
- setValid(isValid: boolean): void - Включает или отключает кнопку отправки формы в зависимости от валидности.
- setError({ field, value, validInformation }: { field: string; value: string; validInformation: string }): void - Показывает или скрывает сообщение об ошибке для конкретного поля.
- showInputError(_field: string, errorMessage: string): void - Отображает переданное сообщение об ошибке.
- hideInputError(_field: string): void - Скрывает сообщение об ошибке.
- validateNotEmpty(field: string, value: string): void - Проверяет, что поле не пустое. Если пустое — устанавливает ошибку.
- checkFormValidity(): void - проверяет, что все поля валидны.
- close(): void - Очищает все поля формы и отключает кнопку отправки.
- handleSubmit(event: Event): void - Обрабатывает отправку формы.
- handleInputChange(event: Event): void - Обрабатывает изменение значения в поле ввода, обновляя его и проверяя на пустоту.
- collectErrors(): void - Собирает элементы, предназначенные для отображения ошибок.

#### Класс Contacts 
Класс Contacts расширяет Form и представляет собой форму для ввода контактных данных (email и телефона).
Методы:
- сетеры.

#### Класс PaymentForm
Класс PaymentForm расширяет Form и представляет собой форму для выбора способа оплаты и ввода адреса доставки.
Поля: 
- _card: HTMLButtonElement — кнопка выбора оплаты картой.
- _cash: HTMLButtonElement — кнопка выбора оплаты наличными.
- paymentMethod: string | null — выбранный способ оплаты ('online' или 'offline').
Методы:
- setActivePaymentButton(activeButton: HTMLButtonElement): void - меняет стили у активных кнопок
- handlePayment(button: HTMLButtonElement, method: string): void - устанавливает значение скрытого поля и вызвает проверку валидации формы 
- getInputValues(): Record<string, string> - Расширяет метод getInputValues родительского класса, добавляя в объект данных выбранный способ оплаты.
- сетер

#### Класс Basket
Класс Basket расширяет View и представляет корзину товаров. Он управляет списком товаров, отображает общую стоимость и предоставляет кнопку для оформления заказа.
Поля:
- _list: HTMLElement — контейнер для отображения товаров в корзине.
- _total: HTMLElement — элемент для отображения общей стоимости товаров.
- _button: HTMLElement — кнопка оформления заказа.
Методы:
- сетеры.

#### Класс Product
Класс отвечает за отображение карточки товара, задавая в карточке данные названия, изображения, описания, тега, цены.
Он используется для отображения товаров на странице сайта (в галерее), в модалке превью и в корзине.
В конструктор класса передаётся DOM-элемент темплейта, что позволяет создавать разные варианты отображения карточки товара. 
Кроме того, в конструктор передаётся экземпляр `EventEmitter` для управления событиями.
Поля класса:
- template: HTMLElement — шаблон карточки товара, который будет заполняться данными.
- eventEmitter: EventEmitter — экземпляр класса, позволяющий инициировать события.
- productData: IProductModel — данные, используемые для заполнения карточки товара.
- _title: HTMLElement — элемент, отображающий название товара.
- _category: HTMLElement | null — элемент, отображающий категорию товара.
- _image: HTMLImageElement | null — элемент, отображающий изображение товара.
- _price: HTMLElement — элемент, отображающий цену товара.
- _description: HTMLElement | null — элемент, отображающий описание товара.
- _button: HTMLButtonElement | null — элемент, отображающий кнопку для взаимодействия с товаром (например, добавление в корзину).
- _index: HTMLElement | null — элемент, отображающий порядковый номер товара (для корзины).
Методы:
- updateButtonText(inCart: boolean): void - обновляет текст у кнопки товара в зависимости от включения его в корзину.
- сетеры

#### Класс Page
Класс Page отвечает за отображение заголовка с кнопкой корзины и счетчиком товаров в корзине.
Поля:
- cartCount: HTMLElement
- _catalog: HTMLElement - Ссылка на DOM-элемент, который отображает количество товаров в корзине.
- _wrapper: HTMLElement - Ссылка на DOM-элемент, который хранит всю страницу
- cartButton: HTMLButtonElement - Ссылка на DOM-элемент кнопки корзины.
Методы:
- updateCartCount(count: number): void - етод для обновления отображаемого количества товаров в корзине на основе данных, получаемых из корзины.
- а также сетеры и гетеры.

#### Класс ProductsContainer
Отвечает за отображение блока с карточками на главной странице. 
Поля класса:
- productsList: HTMLElement - элемент для отображения карточек товаров.
Предоставляет cеттер `products` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки товаров.

#### Класс Success
Класс SuccessMessage представляет сообщение об успешном оформлении заказа. Он отображает сумму списанных средств и предоставляет кнопку закрытия, которая отправляет событие о завершении заказа.
Поля:
- _closeButton: HTMLButtonElement — кнопка закрытия сообщения.
- _total: HTMLElement — элемент, отображающий сумму списанных синапсов.
Методы:
- сетеры.

### Классы коммуникации

#### Презентер
EventEmitter выполняет роль Презентера, связывая модели данных с отображением пользовательских интерфейсов. Он реагирует на события и управляет взаимодействием между моделью и представлением, обновляя интерфейс в ответ на изменения данных.
События:
- modal:open - Это событие отправляется каждый раз, когда закрывается модальное окно.
- modal:close - Это событие отправляется каждый раз, когда закрывается модальное окно.
- basket:open - Это событие отправляется каждый раз, когда открывается корзина.
- products:loaded - Это событие отправляется, когда данные загружены с сервера.
- product:preview - Это событие вызывается, при нажатии на карточку товара.
- basket:addProduct - Это событие вызывается, при добавлении товара в корзину.
- basket:deleteProduct - Это событие вызывается, при удалении товара из корзины.
- basket:update - Рендерит товары в корзине
- counter:update - Это событие вызывается при добавлении или удалении товара из корзины.
- order:open - Это событие вызывается, при нажатии кнопки 'Оформить' в корзине.
- form:submit:order - Это событие вызывается при нажатии кнопки далее в первом форме.
- form:submit:contacts - Это событие вызывается при нажатии кнопки далее во второй форме.
- order:Success - Это событие вызвается при нажатии кнопки За новыми покупками.

#### Класс ApiLarek
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
