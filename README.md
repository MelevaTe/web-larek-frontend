# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Данные товара используемые в его модалке
```
type TProductInfo = Pick<IProductModel, "name" | "category" | "image" | "price" | "description">;
```

Данные используемые в форме оплаты
```
type TOrderPayment = Pick<IOrderModel, "payment" | "address">;
```

Данные используемые в форме пользовательских данных
```
type TOrderInfo = Pick<IOrderModel, "email" | "phone">;
```

Тип оплаты
```
type PaymentType = "online" | "offline";
```

Товар
```
interface IProductModel {
	id: string;
	name: string;
	category: string;
	image: string;
	price: number | null;
	description: string;
}
```

Интерфейс для работы с товарами
```
interface IProduct {
	data: IProductModel;
	getProductInfo(): TProductInfo;
}
```

Заказ
```
interface IOrderModel {
	payment: PaymentType;
	address: string;
	email: string;
	phone: string;
	total: number;
	items: string[];
}
```

Интерфейс для работы с заказом
```
interface IOrder {
	data: IOrderModel;
	setPaymentInfo(paymentInfo: TOrderPayment): void;
	setContactInfo(contactInfo: TOrderInfo): void;
	getTotalPrice(): number;
	validateOrder(): boolean;
}
```

Интерфейс для списка товаров
```
interface IProductList {
	products: IProduct[];
	preview: string | null;
	addProduct(product: IProduct): void;
	deleteProduct(productId: string): void;
	getProduct(productId: string): IProduct;
}
```

Корзина
```
interface ICart {
	products: IProduct[];
	addProduct(product: IProduct): void;
	deleteProduct(productId: string): void;
	clearCart(): void;
	getProducts(): IProduct[];
	getTotalPrice(): number;
}
```

Интерфейс для взаимодействия с сервером
```
interface IApiClient {
	getProductById(productId: string): Promise<IProductModel>;
	getProducts(): Promise<IProductModel[]>;
	createOrder(order: IOrderModel): Promise<IOrderModel>;
}
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие


### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _products: IProduct[] — массив объектов товаров
- _preview: string | null — id товара, выбранного для просмотра в модальном окне
- events: IEvents — экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addProduct(product: IProduct): void — добавляет один продукт в начало массива.
- deleteProduct(productId: string): void — удаляет продукт из массива.
- а так-же сеттеры и геттеры — для сохранения и получения данных из полей класса

#### OrderData
Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _payment: PaymentType — тип платежа (например, "online" или "offline").
- _address: string — адрес для доставки.
- _email: string — email пользователя.
- _phone: string — телефон пользователя.
- _products: IProduct[] — массив продуктов в заказе.
- events: IEvents — экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- setPaymentInfo(paymentInfo: TOrderPayment): void — устанавливает информацию о платеже.
- setContactInfo(contactInfo: TOrderInfo): void — устанавливает информацию о контактах.
- getTotalPrice(): number — вычисляет общую стоимость заказа.
- validateStep1(): boolean -  Проверяет валидность данных, относящихся к первому шагу формы
- validateStep2(): boolean - Проверяет валидность данных второго шага формы
- validateOrder(): boolean — Это общее логическое объединение результатов валидации обоих шагов.

#### Класс CartData
Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _products: IProduct[] — массив продуктов, добавленных в корзину.
- events: IEvents — экземпляр класса EventEmitter для инициации событий при изменении данных корзины.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addProduct(product: IProduct): void — добавляет продукт в корзину.
- deleteProduct(productId: string): void — удаляет продукт из корзины.
- getProducts(): IProduct[] — возвращает все продукты из корзины.
- getTotalPrice(): number — вычисляет общую стоимость продуктов в корзине.
- clearCart(): void; - удаляет все продукты из корзины.


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна.
Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.
-constructor(modalSelector: string, templateId: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно, ID шаблона, который будет использоваться для загрузки контента. и экземпляр класса `EventEmitter` для возможности инициации событий.
Поля класса
- modal: HTMLElement - элемент модального окна
- template: HTMLTemplateElement - элемент шаблона
- events: IEvents - брокер событий

#### Класс ModalWithProduct
Расширяет класс Modal. Предназначен для реализации модального окна с информацией о товаре.
Методы:
- setProductDetails(productData: IProduct): void - Метод получает объект данных о товаре и обновляет соответствующие элементы в разметке

#### Класс ModalWithCart
Расширяет класс Modal. Предназначен для отображения модального окна с корзиной товаров. Модальное окно будет отображать все товары в корзине и предоставлять возможность удаления товара из корзины.
Поля класса:
- submitButton: HTMLButtonElement - кнопка для оформления товаров
- productList: HTMLElement - контейнер для списка товаров в корзине.
- totalPrice: HTMLElement - элемент отвечающий за отображение общей цены товаров 
Методы:
- removeProduct(productId: string): void - Метод удаляет товар из корзины и обновляет отображение в модальном окне, включая пересчет общей стоимости.
- render(): HTMLElement - Возвращает полностью сгенерированное модальное окно корзины с актуальной информацией о товарах и общей стоимости.

#### Класс Product
Класс отвечает за отображение карточки товара, задавая в карточке данные названия, изображения, описания, тега, цены.
Он используется для отображения товаров на странице сайта (в галерее), в модалке превью и в корзине.
В конструктор класса передаётся DOM-элемент темплейта, что позволяет создавать разные варианты отображения карточки товара. 
Кроме того, в конструктор передаётся экземпляр `EventEmitter` для управления событиями.
Поля класса:
- template: HTMLElement -  шаблон карточки товара, который будет заполняться данными.
- eventEmitter: EventEmitter — экземпляр класса, позволяющий инициировать события.
- productData: IProductModel — данные, используемые для заполнения карточки товара.
Методы:
- addEventListener(target: HTMLElement, eventType: string, callback: (event: Event) => void): void - Универсальный метод для добавления обработчиков событий. Позволяет задавать различные слушатели для элементов карточки.
- setData(productData: IProductModel): void - заполняет атрибуты элементов карточки товара данными.
- deleteProduct(): void - метод для удаления разметки карточки товара.
- render(context: "gallery" | "preview" | "cart"): HTMLElement - Метод возвращает заполненную карточку товара и устанавливает слушатели событий в зависимости от контекста отображения.
- геттер id возвращает уникальный id товара.

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна, содержащего форму с полями ввода. При сабмите формы инициирует событие, передавая объект с данными, полученными из полей формы. Также при изменении данных в полях формы инициирует событие, позволяя отслеживать изменения. Класс предоставляет методы для отображения ошибок и управления активностью кнопки подтверждения
Поля класа:
- submitButton: HTMLButtonElement — кнопка для подтверждения.
- _form: HTMLFormElement — элемент формы.
- formName: string — значение атрибута name формы, необходимое для идентификации
- inputs: NodeListOf<HTMLInputElement> — коллекция всех полей ввода в форме
- buttons: NodeListOf<HTMLButtonElement> — коллекция всех кнопок в форме.
- errors: Record<string, HTMLElement> — объект, хранящий элементы для вывода ошибок, с привязкой к атрибуту name каждого инпута.
Методы:
- setValid(isValid: boolean): void — меняет состояние активности кнопки подтверждения в зависимости от значения isValid. Если форма валидна, кнопка активируется, если нет — деактивируется.
- getInputValues(): Record<string, string> — возвращает объект с данными из всех полей формы, где ключ — это атрибут name инпута, а значение — введенные пользователем данные.
- setInputValues(data: Record<string, string>): void — заполняет поля формы данными из переданного объекта. Каждый ключ объекта соответствует атрибуту name инпута.
- setError(data: { field: string, value: string, validInformation: string }): void — принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError(field: string, errorMessage: string): void — отображает текст ошибки под указанным полем ввода.
- hideInputError(field: string): void — очищает текст ошибки под указанным полем ввода, когда ошибка больше не актуальна.
- close(): void — закрывает модальное окно, очищает поля формы и деактивирует кнопку сохранения. Расширяет метод close родительского класса.

#### Класс ModalWithSuccess
Расширяет класс Modal. Предназначен для отображения информации о том, что заказ оформлен и его общей цене.
Поля класса:
- totalPriceElement: HTMLElement - элемент для отображения общей суммы покупки.
- button: HTMLButtonElement -  кнопка выполнения действия, возврата на главную страницу.
Методы: 
- render(): HTMLElement - возвращает полностью сгенерированное модальное окно.

#### Класс Header
Класс Header отвечает за отображение заголовка с кнопкой корзины и счетчиком товаров в корзине.
Поля:
- headerSelector: HTMLElement -  Ссылка на DOM-элемент заголовка, который будет содержать кнопку корзины и счетчик товаров в корзине.
- events: IEvents - брокер событий
- cartButton: HTMLButtonElement - Ссылка на DOM-элемент кнопки корзины.
- cartCount: HTMLElement - Ссылка на DOM-элемент, который отображает количество товаров в корзине.
Методы:
- updateCartCount(cartProducts: IProduct[]): void - етод для обновления отображаемого количества товаров в корзине на основе данных, получаемых из корзины.
- addCartButtonListener(callback: () => void): void - Метод для добавления обработчика событий на кнопку корзины.

#### Класс ProductsContainer
Отвечает за отображение блока с карточками на главной странице. 
Предоставляет cеттер `cards` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки товаров.


### Классы коммуникации

#### Презентер
EventEmitter выполняет роль Презентера, связывая модели данных с отображением пользовательских интерфейсов. Он реагирует на события и управляет взаимодействием между моделью и представлением, обновляя интерфейс в ответ на изменения данных.
События:
- addToCart - Это событие будет отправляться при добавлении товара в корзину. Презентер должен отреагировать, обновить количество товаров в корзине и общую стоимость.
- removeFromCart - Событие, которое обновляет состояние корзины, уменьшая количество товаров и пересчитывая общую стоимость.
- openProductModal - Это событие открывает модальное окно с деталями товара, показывая дополнительную информацию о нем.
- closeProductModal - Событие для закрытия модального окна с товаром.
- openCartModal - Это событие открывает модальное окно корзины, где отображаются добавленные товары и общая стоимость.
- closeCartModal - обытие для закрытия модального окна корзины.
- startCheckout - Это событие активирует процесс оформления заказа, позволяя пользователю выбрать способ оплаты и заполнить необходимые поля.
-  fillCheckoutForm - Событие будет отслеживать, что все необходимые данные заполнены, и активировать кнопку "Продолжить".
- submitOrder - Это событие отправляет данные заказа на сервер и отображает сообщение о успешном оформлении с общей стоимостью заказа.
- returnToHomePage - Событие для возврата на главную страницу, возможно, с очисткой корзины и начальной настройкой интерфейса.
#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
